# 待辦任務 (Backlog)

> 延後處理或優先度較低的任務。定期檢視是否需要移入 TASKS.md。

## 深夜任務

<!-- Claude 可獨立執行的任務，標記 [深夜] -->

---

## 一般待辦

<!-- 一般延後的任務 -->

### 發文追蹤雷達 - 行為建議指引

**優先級**：中
**類型**：UX 增強

目前儀表板已有完整的數據呈現（點火曲線、熱力圖、擴散動態、四象限圖），但缺乏**行動指引**——小編或使用者看到這些訊息跟圖表之後應該做什麼。

**需求內容**：
- 根據貼文狀態提供具體的行動建議
- 例如：
  - 🔥 加速擴散中 → 「建議：趁熱追加回覆互動、分享到其他平台」
  - 🌱 剛開始擴散 → 「建議：觀察 30 分鐘，考慮是否投放推廣」
  - 💤 熱度趨緩 → 「建議：此文已過高峰期，專注下一篇內容」
  - 早熱型 → 「此類內容適合即時話題，建議記錄成功模式」
- 可考慮在卡片下方、表格 hover、或獨立「建議」欄位呈現

---

## 技術債

<!-- 需要處理的技術債項目 -->

---

## 優化項目

<!-- 非緊急的優化建議 -->

### Hourly Metrics 查詢優化 - 排除零值記錄

**優先級**：低
**提出日期**：2026-01-13
**類型**：效能優化

**現況**：
- 總覽頁趨勢圖查詢多貼文的 hourly 資料（25 篇 × 60+ 小時 ≈ 1500+ 筆）
- 前端做聚合計算（按時間桶加總）
- Supabase max rows 已調整為 10000

**優化方案**：
在查詢時加上篩選條件，排除所有成效都為零的記錄：
```sql
WHERE (views > 0 OR likes > 0 OR replies > 0 OR reposts > 0 OR quotes > 0)
```

**影響範圍**：
| 檔案 | 用途 | 是否需要 |
|------|------|----------|
| `insights/page.tsx` | 總覽趨勢圖（多貼文聚合） | 建議加上 |
| `posts/[id]/page.tsx` | 單篇貼文成效圖 | 資料量小，可選 |
| `posts/page.tsx` | 貼文列表 sparkline | 資料量小，可選 |
| `reports/page.tsx` | 報表頁面 | 待評估 |

**決策**：
- 資料保留不變（不在 rollup 階段過濾）
- 查詢時用 WHERE 篩選，確保資料完整性可追蹤

---

## 待討論議題

### Onboarding 首次上線自動擷取貼文策略

**狀態**：待討論
**提出日期**：2026-01-13

新用戶首次 onboarding 後，系統應自動擷取多少歷史貼文？

**現況分析**：

| 項目 | 現況 | 說明 |
|------|------|------|
| API 單次上限 | 100 筆 | Threads API limit 參數最大值 |
| 目前實作 | 100 筆 | `syncPostsForAccount` 預設值，無分頁 |
| 分頁支援 | 未實作 | API 支援 cursor-based 分頁 |

**討論方向**：

1. **擷取數量策略**
   - 固定筆數（如 200、500 筆）
   - 固定時間範圍（如最近 3 個月、6 個月）
   - 混合策略（最多 500 筆 或 6 個月內，以先達到者為準）

2. **效能與成本考量**
   - 每篇貼文需額外呼叫 API 取得 insights
   - AI tagging 會入隊處理（LLM 成本）
   - 首次同步時間可能較長

3. **用戶體驗**
   - 是否需要顯示同步進度？
   - 歷史資料對新用戶的價值？
   - 延遲追蹤（>3hr）的貼文如何處理？

4. **實作優先級**
   - Phase 1：實作分頁，支援抓取更多貼文
   - Phase 2：設定合理的上限策略
   - Phase 3：優化首次同步體驗

---

### 中期文章與長尾文分析的必要性

**狀態**：待討論
**提出日期**：2026-01-12

目前發文追蹤雷達專注於**早期文章**（72 小時內），是否有必要擴展至中期與長尾文章的分析？

**討論方向**：

| 階段 | 時間範圍 | 可能用途 |
|------|----------|----------|
| 早期 | 0-72 小時 | ✅ 已實作：即時追蹤、爆紅預警 |
| 中期 | 3-14 天 | 內容效益評估、A/B 測試結論 |
| 長尾 | 14 天以上 | SEO/搜尋流量、常青內容識別 |

**待釐清問題**：
1. Threads 平台的內容生命週期特性（是否有長尾效應？）
2. 用戶實際需求（小編是否關注超過一週的舊文？）
3. 儲存與效能考量（長期資料的保留策略）
4. 與現有「貼文分析」頁面的功能區隔

---

### 貼文詳情面板 - P1 功能

**狀態**：待討論
**提出日期**：2026-01-15

P0 功能已完成（相對比較、一句話結論、負面留言標示、數據複製、帳號標示強化），以下是 P1 待實作功能：

**前端可獨立做**：

| 功能 | 受眾需求 | 說明 |
|------|----------|------|
| 格式化複製 | Agency 🔴 / Brand 🔴 | 直接可貼入報告的格式 |
| 匯出圖片 | Brand 🔴 | 截圖/匯出成效卡片 |

**需後端配合**：

| 功能 | 受眾需求 | 說明 |
|------|----------|------|
| 處理人記錄 | Agency 🔴 | 記錄誰回覆的 |
| 負評推播通知 | Brand 🔴 | 負面留言即時通知 |
| KPI 達成狀態 | Brand 🔴 | 顯示是否達標 |

**已有功能**：
- 留言處理狀態（已回覆/待處理）- API 會下鑽一層檢查 `has_owner_reply`

**暫不實作**：
- 快速切換上/下篇 - 因開啟來源不同（貼文清單、Top 5、中期追蹤等）導致架構複雜

---

### Global Header 貼文切換器

**狀態**：待討論
**提出日期**：2026-01-15

作為「快速切換上/下篇」的替代方案，在 Global Header 加入貼文切換器。

**設計概念**：
```
┌─────────────────────────────────────────────────────┐
│ [Logo]  Dashboard  Posts  Insights  [📄 切換貼文 ▼] │
└─────────────────────────────────────────────────────┘
                                           │
                                           ▼
                               ┌─────────────────────┐
                               │ 🔍 搜尋貼文...      │
                               ├─────────────────────┤
                               │ 最近的文章都很棒... │
                               │ 今天分享一個小技巧  │
                               │ 週末快樂！大家...   │
                               └─────────────────────┘
```

**優點**：
- 解耦：不需要知道從哪個列表開啟
- 更靈活：可搜尋、可看最近貼文
- 一致體驗：不管在哪個頁面都能用

**實作方式**：
1. 條件顯示 - 只在 post-detail-panel 開啟時顯示按鈕
2. Popover/Command - 用 cmdk 或 shadcn Command 元件
3. 狀態管理 - 用 Zustand 管理目前開啟的 postId

---

### 報表功能 - 成效報告匯出

**狀態**：Phase 1 已完成，待討論後續
**提出日期**：2026-01-15
**更新日期**：2026-01-16
**需求探索報告**：`.claude/skills/needs-discovery/reports/2026-01-15-report-feature/`

#### 已完成功能

| 格式 | 內容 | 狀態 |
|------|------|------|
| PNG 單頁 | 成效摘要圖 (1920x1080) | 已完成 |
| PDF 單頁 | 同上，PDF 格式 | 已完成 |
| PDF 5頁 | 摘要/趨勢/貼文排行/分類/時段 | 已完成 |
| CSV | 彙總報表/明細報表 | 已完成 |

#### 待討論方向

**1. 報表類型擴充**
- 週報 / 月報 / 季報（固定格式）
- 單篇貼文深度分析報告
- 競品/多帳號比較報表

**2. 版面配置優化**
- 目前 5 頁內容分配是否適當
- 頁面順序調整或合併
- 圖表樣式偏好（長條圖/折線圖/圓餅圖）

**3. 客製化選項**
- 主題色擴充（目前僅單頁支援）
- Logo 置換（白標功能）
- 區塊顯示/隱藏設定

**4. 進階功能**
- PowerPoint 匯出
- 自動化報表排程
- 報表範本管理

#### 原始需求分析

**需求優先級（依受眾）**：

| 受眾 | 優先級 | 核心需求 | 付費意願 |
|------|--------|----------|----------|
| Freelancer | 低 | 截圖就夠了 | 低 |
| Agency Editor | 中 | Excel 匯出給主管 | 低（公司決定）|
| Brand Editor | 中高 | 月報向主管匯報 | 中 |
| Consultant | 高 | 白標報告給客戶 | **高** |
| Manager | 高 | ROI 報告說服高層 | **高** |

**關鍵洞察**：
> 「儀表板已經很清楚了，我幹嘛還要報表？除非是要給客戶看。」— Freelancer
> 「報表是我向客戶證明價值的最佳工具，我願意為這個功能付費。」— Consultant
> 「我需要能用數據說服高層的報表，ROI 分析對我很重要。」— Manager

---

### 貼文刪除狀態同步機制

**狀態**：待討論
**提出日期**：2026-01-16

社群平台（Threads）與外部平台（Postlyzer）之間的貼文刪除狀態如何同步處理。

**需釐清的情境**：

| 問題 | 待討論 |
|------|--------|
| 刪除的「目的」 | 記錄？隱藏？影響統計？ |
| 刪除的「來源」 | 用戶在 Threads 刪、在 Postlyzer 刪、平台自動刪 |
| 刪除後的「顯示」 | 完全隱藏？標記刪除線？獨立分類？ |
| 對「統計」的影響 | 已刪除貼文是否計入發文數/成效？ |
| 追蹤範圍 | 只追蹤平台發的？還是所有貼文？ |

**可能的方案**：

| 方案 | 說明 | 優缺點 |
|------|------|--------|
| 定期全量掃描 | 每天用貼文 ID 逐一查詢 | 準確但 API 壓力大 |
| 分層頻率檢查 | 新文每次檢查、舊文每天/每週 | 平衡準確度與 API |
| 惰性檢查 | 只在用戶查看時檢查 | 省 API 但不即時 |
| 只追蹤平台發的 | 只追蹤 outbound_posts | 範圍明確、壓力小 |

**現有實作**：
- `outbound_posts` 表有 `deleted_at` 和 `deletion_source` 欄位
- `deletion_source` enum: `sync_detected` / `platform_deleted`
- `sync-posts` 有刪除偵測邏輯（但只比對貼文列表，有數量限制問題）

---

### MCP Server - AI 可讀取分析數據

**狀態**：待討論
**提出日期**：2026-01-14

開發 MCP (Model Context Protocol) Server，讓 AI 助手可以存取用戶的 Threads 分析數據。

**可能的使用場景**：
1. **個人查詢** - 用戶透過 AI 問「我上週表現最好的貼文是哪篇？」
2. **內容建議** - AI 根據歷史數據建議最佳發文時間
3. **報告生成** - AI 自動撰寫週報/月報摘要

**初步 Endpoints 構想**：
| Endpoint | 說明 |
|----------|------|
| `/threads-stats` | 取得帳號總覽統計 |
| `/top-posts` | 取得熱門貼文列表 |
| `/best-time` | 取得最佳發文時間分析 |
| `/recent-growth` | 取得近期成長數據 |

**待釐清問題**：
1. **目標用戶** - 給 Postlyzer 用戶自己用，還是開放給其他開發者？
2. **認證機制** - 如何驗證 MCP 請求的身份？（API Key / OAuth）
3. **資料範圍** - 開放哪些資料？唯讀還是可寫入？
4. **開發優先級** - Beta 階段是否需要此功能？
