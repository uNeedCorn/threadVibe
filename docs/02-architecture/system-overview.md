# 系統架構總覽

## 架構圖

```
┌─────────────────────────────────────────────────────────────────┐
│                         Client Layer                             │
├─────────────────────────────────────────────────────────────────┤
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │   Next.js    │  │   React      │  │   Tailwind   │          │
│  │   App Router │  │   Query      │  │   CSS        │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      Supabase Platform                           │
├─────────────────────────────────────────────────────────────────┤
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │   Supabase   │  │    Edge      │  │   Realtime   │          │
│  │   Auth       │  │   Functions  │  │   (optional) │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
│         │                 │                                      │
│         ▼                 ▼                                      │
│  ┌──────────────────────────────────────────────────┐          │
│  │              PostgreSQL Database                  │          │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌────────┐ │          │
│  │  │  RLS    │ │ Tables  │ │  Views  │ │  RPC   │ │          │
│  │  └─────────┘ └─────────┘ └─────────┘ └────────┘ │          │
│  └──────────────────────────────────────────────────┘          │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      External Services                           │
├─────────────────────────────────────────────────────────────────┤
│  ┌──────────────┐  ┌──────────────┐                             │
│  │   Google     │  │   Threads    │                             │
│  │   OAuth      │  │   Graph API  │                             │
│  └──────────────┘  └──────────────┘                             │
└─────────────────────────────────────────────────────────────────┘
```

---

## 層級說明

### Client Layer (前端)

| 技術 | 用途 |
|------|------|
| Next.js 14 | App Router、SSR/SSG |
| React Query | 資料快取、狀態管理 |
| Tailwind CSS | UI 樣式 |
| shadcn/ui | UI 元件庫 |
| Recharts | 圖表視覺化 |

### Supabase Platform (後端)

| 服務 | 用途 |
|------|------|
| Supabase Auth | Google OAuth、Session 管理 |
| Edge Functions | Deno runtime、API 端點 |
| PostgreSQL | 資料儲存、RLS 權限控管 |
| Cron Jobs | 定時同步任務 |

### External Services (外部服務)

| 服務 | 用途 |
|------|------|
| Google OAuth | 使用者身份驗證 |
| Threads Graph API | 貼文與成效數據 |

---

## 資料流

### 認證流程

```
User → Google OAuth → Supabase Auth → JWT → Frontend
```

### 資料同步流程

```
Cron Job → Edge Function → Threads API → PostgreSQL
```

### 資料查詢流程

```
Frontend → Supabase Client → RLS → PostgreSQL → Response
```

---

## 部署架構

| 環境 | Frontend | Backend |
|------|----------|---------|
| Production | Vercel | Supabase Cloud |
| Staging | Vercel Preview | Supabase Branch |

---

## 安全機制

| 層級 | 機制 |
|------|------|
| 傳輸層 | HTTPS/TLS |
| 認證 | JWT Token + Refresh |
| 授權 | RLS (Row Level Security) |
| Token 儲存 | 加密欄位 (pgcrypto) |
